-------------------------------
Bilayer Builder Simulation Tips
-------------------------------

This file explains a few of the pitfalls experienced when trying to
simulate systems created by the Bilayer Builder. It also explains
some of the more detailed code within the Bilayer Builder that was
specific to the author's local machine, and that will need to be
changed before engaging in simulation efforts.

BASIC SIMULATION SOFTWARE USED

Simulation Engine: GROMACS 2016.3 (This is the only simulation
engine currently supported by the Bilayer Builder, but versions of
GROMACS 3.x and newer ought to work fine)
Force Field: GROMOS53a6 (All testing has been done with this force
field, and the validity of other force fields for use with the
Bilayer Builder cannot be guaranteed)

CREATION OF THE TOPOLOGY

The Bilayer Builder creates a topology file that uses include
statements to access GROMACS .itp files. The user can specify the
path using the parameter itp_path (data type str).

Due to the simulation methodology, the bilayer utilizes not only
GROMOS53a6 .itp files, but duplicate files with the charges removed
as well. These files will have to be created by the user, or
accessed at www.github.com/ahy3nz (clone the "setup" repository)

SIMULATION METHODOLOGY

Energy Minimization
    -- 4 steps total, all with an Fmax of 1000
    -- First 3 steps use .itp files with no charges
    -- During first 3 steps, the VDW forces are gradually increased
    from 0% to 100% to accomodate steric overlap
NVT Equilibration
    -- 100 picoseconds, Nose-Hoover thermostat
Simulated Tempering and NPT Equilibration
    -- 50 nanoseconds 
    -- Random walk in temperature space from 305 K to 325 K
    -- Berendsen barostat
MD simulation
    -- 100 nanoseconds

All necessary .mdp files and run scripts can be found at
www.github.com/ahy3nz (clone the "setup" repository)

COMMON SIMULATION ERRORS

Simulation fails during the grompp step: this is most likely a topology file error, possibly one of the
following:
    -- The .itp file molecules have different names than the residues
    found in the .gro file. To fix this, go into the .itp files and
    make sure that the molecule names are identical to those in the
    .gro file created by mBuild.
    -- There is an error in the names of the residues in the created
    .gro file. Go into that file and check that the residue name and
    atom names and orders all match up exactly with the .itp files
    for each lipid being simulated.

Error: too many LINCS warnings. This most likely will happen almost
immediately during energy minimization, and means that your
simulation methodology has not removed steric overlaps.
    -- It is possible, and has happened before, that the Bilayer
    Builder placed one atom directly on top of another. The energy
    minimzation step cannot fix this. Use VMD to examine the .gro
    file visually, and if you believe this to be the case, create
    another IC using the Builder (it is highly unlikely this problem
    will occur more than once)
    -- It is more likely that you have not modulate the VDW
    correctly. Make sure that the first EM step has them turned off,
    and that the structure is sufficiently minimized before turning
    them on 100%, and especially before turning on the atom charges

ERRORS IN THE FINAL STRUCTURE

If the system successfully makes it through energy minimization, it
is likely that the simulation will successfully complete all the way
through its production run. The following problems have been noticed
with a successfully simulated system.

Periodicity is lost in one or more dimensions: It is always important
to examine the GROMACS trajectory of every step in a failed
simulation, and is essential to debugging this issue.
    -- If periodicity is lost during NVT, it is very likely that the
    initial APL is too large. That is why it is recommended that the
    user NOT change the default area per lipid values in the Bilayer
    Builder, which have been intelligently designed.
    -- Did you change the box size inside the Bilayer Builder? If so,
    try switching it back to the default.
This has been discovered to be the root of a lot of problems in
GROMACS simulations of mBuild-created bilayers. 

Lipids falling into/out of the bilayer: this problem can often be
discovered by examining the tilt angle distributions of the final
structure.
    -- Check the trajectories of both the simulated tempering step
    and the MD production run to find out when the lipid fell out.
    -- Try lowering the coupling constant on the berendsen barostat
    during simulated tempering
    -- Check out the .gro file post-NVT: is there excessive space
    between the two leaflets? If so, try lowering the spacing between
    the two leaflets, or lowering the APL

NOTE: It is a known bug with these simulations that some interactions
are said to be "outside the table distance" by GROMACS. This error
should be ignored, as many simulations have been successfully run
without addressing it.


